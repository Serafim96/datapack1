function hell_castle:header_processing